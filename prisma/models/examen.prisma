enum TipoExamen {
    Sync
    Async
    Solo
    Alumno
}

model Examen {
    id          String  @id @default(cuid())
    title       String  @db.Text
    description String? @db.Text
    img         String?
    video       String?
    audio       String?
    peso        Int     @default(1) @db.TinyInt

    user_id Int
    user    User @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

    curso_id String
    curso    Curso  @relation(fields: [curso_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

    inicio_examen DateTime?
    final_examen  DateTime?

    tipo_examen TipoExamen @default(Async)

    rubrica_holistica_id String?
    rubrica_holistica    RubricaHolistica? @relation(fields: [rubrica_holistica_id], references: [id], onDelete: Restrict, onUpdate: Cascade)

    rubrica_analitica_id String?
    rubrica_analitica    RubricaAnalitica? @relation(fields: [rubrica_analitica_id], references: [id], onDelete: Restrict, onUpdate: Cascade)

    state_id Int
    state    State @relation(fields: [state_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

    pregunta_actual_sync_id String?   @unique
    pregunta_actual_sync    Pregunta? @relation("pregunta_actual_sync", fields: [pregunta_actual_sync_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

    preguntas   Pregunta[]
    historial   Historial[]
    ejecuciones EjecucionExamen[]

    created_at DateTime  @default(now())
    updated_at DateTime  @updatedAt
    deleted_at DateTime?

    @@map("examen")
}

model Pregunta {
    id          String   @id @default(cuid())
    title       String   @db.Text
    description String?
    img         String?
    video       String?
    audio       String?
    puntos      Int      @default(1) @db.TinyInt
    duracion    Decimal? @db.Decimal(6, 2)
    examen_id   String

    indicadores                     Indicadores[]
    examen                          Examen                     @relation(fields: [examen_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    examen_con_pregunta_actual_sync Examen?                    @relation("pregunta_actual_sync")
    respuestas                      Respuesta[]
    preguntasEjecucionExamen        PreguntasEjecucionExamen[]

    @@map("pregunta")
}

model Respuesta {
    id                String  @id @default(cuid())
    respuesta         String  @db.Text
    img               String?
    video             String?
    audio             String?
    correcta          Boolean @default(false)
    retroalimentacion String? @db.Text

    pregunta_id               String
    pregunta                  Pregunta                   @relation(fields: [pregunta_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    respuestasEjecucionExamen PreguntasEjecucionExamen[]

    @@map("respuesta")
}
